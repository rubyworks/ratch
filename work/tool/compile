#!/usr/bin/env ratch

# compile extensions

main :compile => [ :make_config ] do
  extension_directories.each do |directory|
    build File.join(directory, 'Makefile')
    cd(directory) do
      make
    end
  end
end

# Setup Makefile builds

task :make_config do
  extension_directories.each do |directory|
    file File.join(directory, 'Makefile') do
      cd(directory) do
        ruby "extconf.rb"
      end
    end
  end
end

#

def extension_directories
  glob('ext/**/extconf.rb').map do |ext|
    File.dirname(ext)
  end
end




# Eric Hodel said NOT to copy the compiled libs.
#
#task :copy_files do
#  cp "ext/**/*.#{dlext}", "lib/**/#{arch}/"
#end
#
#def dlext
#  Config::CONFIG['DLEXT']
#end
#
#def arch
#  Config::CONFIG['arch']
#end
